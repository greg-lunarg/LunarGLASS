
Top IR:
; ModuleID = 'Glslang'

@BaseColor = global <4 x float> zeroinitializer
@Count = external addrspace(2) constant i32
@bigColor = external addrspace(2) constant <4 x float>
@gl_FragColor = global <4 x float> zeroinitializer
@v4 = external addrspace(2) constant <4 x i32>
@f = global float 0.000000e+00

define fastcc void @main() {
entry:
  %i28 = alloca i32
  %i21 = alloca i32
  %r = alloca <4 x float>
  %gl_FragColor19 = alloca <4 x float>
  %tv4 = alloca <4 x float>
  %i12 = alloca i32
  %i4 = alloca i32
  %sum = alloca float
  %i = alloca i32
  %color = alloca <4 x float>
  br label %mainBody

mainBody:                                         ; preds = %entry
  %color1 = load <4 x float>* @BaseColor
  store <4 x float> %color1, <4 x float>* %color
  store i32 0, i32* %i
  br label %loop-header

loop-header:                                      ; preds = %ifmerge, %mainBody
  %0 = load i32* %i
  %1 = load i32 addrspace(2)* @Count, !gla.uniform !5
  %2 = icmp slt i32 %0, %1
  %3 = xor i1 %2, true
  br i1 %3, label %then, label %ifmerge

then:                                             ; preds = %loop-header
  br label %loop-merge

post-loop-break:                                  ; No predecessors!
  unreachable

ifmerge:                                          ; preds = %loop-header
  %4 = load <4 x float> addrspace(2)* @bigColor, !gla.uniform !7
  %5 = load <4 x float>* %color
  %color2 = fadd <4 x float> %5, %4
  store <4 x float> %color2, <4 x float>* %color
  %6 = load i32* %i
  %i3 = add i32 %6, 1
  store i32 %i3, i32* %i
  br label %loop-header

loop-merge:                                       ; preds = %then
  %gl_FragColor = load <4 x float>* %color
  store <4 x float> %gl_FragColor, <4 x float>* @gl_FragColor
  store float 0.000000e+00, float* %sum
  store i32 0, i32* %i4
  br label %loop-header5

loop-header5:                                     ; preds = %ifmerge8, %loop-merge
  %7 = load i32* %i4
  %8 = icmp slt i32 %7, 4
  %9 = xor i1 %8, true
  br i1 %9, label %then6, label %ifmerge8

then6:                                            ; preds = %loop-header5
  br label %loop-merge11

post-loop-break7:                                 ; No predecessors!
  unreachable

ifmerge8:                                         ; preds = %loop-header5
  %10 = load i32* %i4
  %11 = load <4 x i32> addrspace(2)* @v4, !gla.uniform !8
  %12 = extractelement <4 x i32> %11, i32 %10
  %13 = uitofp i32 %12 to float
  %14 = load float* %sum
  %sum9 = fadd float %14, %13
  store float %sum9, float* %sum
  %15 = load i32* %i4
  %i410 = add i32 %15, 1
  store i32 %i410, i32* %i4
  br label %loop-header5

loop-merge11:                                     ; preds = %then6
  store i32 0, i32* %i12
  br label %loop-header13

loop-header13:                                    ; preds = %ifmerge16, %loop-merge11
  %16 = load i32* %i12
  %17 = icmp slt i32 %16, 4
  %18 = xor i1 %17, true
  br i1 %18, label %then14, label %ifmerge16

then14:                                           ; preds = %loop-header13
  br label %loop-merge18

post-loop-break15:                                ; No predecessors!
  unreachable

ifmerge16:                                        ; preds = %loop-header13
  %19 = load i32* %i12
  %20 = load i32* %i12
  %21 = load <4 x i32> addrspace(2)* @v4, !gla.uniform !8
  %22 = extractelement <4 x i32> %21, i32 %20
  %23 = mul i32 %22, 4
  %24 = uitofp i32 %23 to float
  %25 = getelementptr <4 x float>* %tv4, i32 0, i32 %19
  store float %24, float* %25
  %26 = load i32* %i12
  %i1217 = add i32 %26, 1
  store i32 %i1217, i32* %i12
  br label %loop-header13

loop-merge18:                                     ; preds = %then14
  %27 = load float* %sum
  %28 = load <4 x float>* %gl_FragColor19
  %29 = insertelement <4 x float> undef, float %27, i32 0
  %30 = insertelement <4 x float> %29, float %27, i32 1
  %31 = insertelement <4 x float> %30, float %27, i32 2
  %32 = insertelement <4 x float> %31, float %27, i32 3
  %33 = load <4 x float>* %tv4
  %34 = fadd <4 x float> %32, %33
  %35 = load <4 x float>* @gl_FragColor
  %gl_FragColor20 = fadd <4 x float> %35, %34
  store <4 x float> %gl_FragColor20, <4 x float>* @gl_FragColor
  %36 = load <4 x float>* @BaseColor
  %37 = extractelement <4 x float> %36, i32 0
  %38 = insertelement <3 x float> undef, float %37, i32 0
  %39 = extractelement <4 x float> %36, i32 1
  %40 = insertelement <3 x float> %38, float %39, i32 1
  %41 = extractelement <4 x float> %36, i32 2
  %42 = insertelement <3 x float> %40, float %41, i32 2
  %43 = extractelement <3 x float> %42, i32 0
  %44 = getelementptr <4 x float>* %r, i32 0, i32 0
  store float %43, float* %44
  %45 = extractelement <3 x float> %42, i32 1
  %46 = getelementptr <4 x float>* %r, i32 0, i32 1
  store float %45, float* %46
  %47 = extractelement <3 x float> %42, i32 2
  %48 = getelementptr <4 x float>* %r, i32 0, i32 2
  store float %47, float* %48
  store i32 0, i32* %i21
  br label %loop-header22

loop-header22:                                    ; preds = %ifmerge25, %loop-merge18
  %49 = load i32* %i21
  %50 = load i32 addrspace(2)* @Count, !gla.uniform !5
  %51 = icmp slt i32 %49, %50
  %52 = xor i1 %51, true
  br i1 %52, label %then23, label %ifmerge25

then23:                                           ; preds = %loop-header22
  br label %loop-merge27

post-loop-break24:                                ; No predecessors!
  unreachable

ifmerge25:                                        ; preds = %loop-header22
  %53 = load float* @f
  %54 = getelementptr <4 x float>* %r, i32 0, i32 3
  store float %53, float* %54
  %55 = load i32* %i21
  %i2126 = add i32 %55, 1
  store i32 %i2126, i32* %i21
  br label %loop-header22

loop-merge27:                                     ; preds = %then23
  %56 = load <4 x float>* %r
  %57 = extractelement <4 x float> %56, i32 0
  %58 = insertelement <3 x float> undef, float %57, i32 0
  %59 = extractelement <4 x float> %56, i32 1
  %60 = insertelement <3 x float> %58, float %59, i32 1
  %61 = extractelement <4 x float> %56, i32 2
  %62 = insertelement <3 x float> %60, float %61, i32 2
  %63 = load <4 x float>* @gl_FragColor
  %64 = extractelement <4 x float> %63, i32 0
  %65 = insertelement <3 x float> undef, float %64, i32 0
  %66 = extractelement <4 x float> %63, i32 1
  %67 = insertelement <3 x float> %65, float %66, i32 1
  %68 = extractelement <4 x float> %63, i32 2
  %69 = insertelement <3 x float> %67, float %68, i32 2
  %70 = fadd <3 x float> %69, %62
  %71 = extractelement <3 x float> %70, i32 0
  store float %71, float* getelementptr inbounds (<4 x float>* @gl_FragColor, i32 0, i32 0)
  %72 = extractelement <3 x float> %70, i32 1
  store float %72, float* getelementptr inbounds (<4 x float>* @gl_FragColor, i32 0, i32 1)
  %73 = extractelement <3 x float> %70, i32 2
  store float %73, float* getelementptr inbounds (<4 x float>* @gl_FragColor, i32 0, i32 2)
  store i32 0, i32* %i28
  br label %loop-header29

loop-header29:                                    ; preds = %ifmerge32, %loop-merge27
  %74 = load i32* %i28
  %75 = icmp slt i32 %74, 16
  %76 = xor i1 %75, true
  br i1 %76, label %then30, label %ifmerge32

then30:                                           ; preds = %loop-header29
  br label %loop-merge35

post-loop-break31:                                ; No predecessors!
  unreachable

ifmerge32:                                        ; preds = %loop-header29
  %77 = load float* @f
  %78 = load <4 x float>* @gl_FragColor
  %79 = insertelement <4 x float> undef, float %77, i32 0
  %80 = insertelement <4 x float> %79, float %77, i32 1
  %81 = insertelement <4 x float> %80, float %77, i32 2
  %82 = insertelement <4 x float> %81, float %77, i32 3
  %gl_FragColor33 = fmul <4 x float> %78, %82
  store <4 x float> %gl_FragColor33, <4 x float>* @gl_FragColor
  %83 = load i32* %i28
  %i2834 = add i32 %83, 4
  store i32 %i2834, i32* %i28
  br label %loop-header29

loop-merge35:                                     ; preds = %then30
  br label %stage-epilogue

stage-epilogue:                                   ; preds = %loop-merge35
  br label %stage-exit

stage-exit:                                       ; preds = %stage-epilogue
  ret void
}

!gla.entrypoint = !{!0}
!gla.inputs = !{!1, !3}
!gla.uniforms = !{!5, !7, !8}
!gla.outputs = !{!10}

!0 = !{!"main", i32 15}
!1 = !{!"BaseColor", i32 1, <4 x float>* @BaseColor_typeProxy, !2}
!2 = !{i32 0, i32 0, i32 1024, null, i32 1, i32 0, i32 -1, i32 0, i32 -1}
!3 = !{!"f", i32 1, float* @f_typeProxy, !4}
!4 = !{i32 0, i32 0, i32 1026, null, i32 1, i32 0, i32 -1, i32 0, i32 -1}
!5 = !{!"Count", i32 12, i32* @Count_typeProxy, !6}
!6 = !{i32 0, i32 0, i32 1024, null, i32 -1, i32 0, i32 -1, i32 0, i32 -1}
!7 = !{!"bigColor", i32 12, <4 x float>* @bigColor_typeProxy, !6}
!8 = !{!"v4", i32 12, <4 x i32>* @v4_typeProxy, !9}
!9 = !{i32 1, i32 0, i32 1024, null, i32 -1, i32 0, i32 -1, i32 0, i32 -1}
!10 = !{!"gl_FragColor", i32 7, <4 x float>* @gl_FragColor_typeProxy, !11}
!11 = !{i32 0, i32 0, i32 1025, null, i32 0, i32 43, i32 -1, i32 0, i32 -1}
LunarGOO: /home/greg/ss/LunarGLASS.36/Core/LLVM/llvm-3.6.2/lib/Analysis/ScalarEvolution.cpp:4391: unsigned int llvm::ScalarEvolution::getSmallConstantTripCount(llvm::Loop*, llvm::BasicBlock*): Assertion `L->isLoopExiting(ExitingBlock) && "Exiting block must actually branch out of the loop!"' failed.
